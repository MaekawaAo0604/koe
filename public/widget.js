!function(){"use strict";function e(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function t(t,o){const a=o.show_date?`<div class="koe-date">${e(new Date(t.created_at).toLocaleDateString("ja-JP"))}</div>`:"";return'<div class="koe-card">'+function(e,t){if(!t)return"";const o=Array.from({length:5},(t,o)=>`<span class="koe-star${o<e?" on":""}">&#9733;</span>`).join("");return`<div class="koe-stars" aria-label="${e}点中5点">${o}</div>`}(t.rating,o.show_rating)+`<div class="koe-content">“${e(t.content)}”</div><div class="koe-author">`+function(t,o){return o?t.author_avatar_url?`<div class="koe-avatar"><img src="${e(t.author_avatar_url)}" alt="${e(t.author_name)}" loading="lazy"></div>`:`<div class="koe-avatar" aria-hidden="true">${e(t.author_name.charAt(0).toUpperCase())}</div>`:""}(t,o.show_avatar)+'<div class="koe-author-info">'+`<div class="koe-author-name">${e(t.author_name)}</div>`+function(t){const o=[t.author_title,t.author_company].filter(Boolean);return o.length?`<div class="koe-author-meta">${e(o.join(" / "))}</div>`:""}(t)+"</div></div>"+a+"</div>"}!function(){const e=document.currentScript||(()=>{var e;const t=document.querySelectorAll('script[src*="widget.js"]');return null!==(e=t[t.length-1])&&void 0!==e?e:null})(),o=e?new URL(e.src).origin:"https://koe.example.com";document.querySelectorAll("script[data-widget]").forEach(e=>{const a=e.getAttribute("data-widget");if(!a)return;const i=document.createElement("div");i.setAttribute("data-koe",a),e.parentNode.insertBefore(i,e);const n=i.attachShadow({mode:"open"});(async function(e,t){const o=await fetch(`${e}/api/widgets/${t}/data`);if(!o.ok)throw new Error(`[Koe] Failed to fetch widget data: ${o.status}`);return o.json()})(o,a).then(e=>{const{widget:a,testimonials:i,plan:r}=e,l=a.config,s=document.createElement("style");s.textContent=function(e){const t="dark"===e.theme,o=t?"#111827":"#f9fafb",a=t?"#1f2937":"#ffffff",i=t?"#374151":"#e5e7eb",n=t?"#f9fafb":"#111827",r=t?"#9ca3af":"#6b7280",l=t?"#4b5563":"#d1d5db",s=t?"#374151":"#e5e7eb",c=t?"#d1d5db":"#374151",d=t?"#4b5563":"#d1d5db",u=`${e.border_radius}px`,p=e.columns>0?e.columns:3;return`*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}:host{display:block;font-family:${e.font_family&&"inherit"!==e.font_family?e.font_family:'-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif'};-webkit-font-smoothing:antialiased;color-scheme:${e.theme}}.koe-widget{background:${o};padding:16px}.koe-card{background:${a};border:1px solid ${i};border-radius:${u};padding:16px;`+(e.shadow?"box-shadow:0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.07)":"")+"}.koe-stars{display:flex;gap:2px;margin-bottom:8px;line-height:1}"+`.koe-star{font-size:13px;color:${l}}.koe-star.on{color:#f59e0b}`+`.koe-content{color:${n};font-size:14px;line-height:1.65;margin-bottom:12px}.koe-author{display:flex;align-items:center;gap:8px}`+`.koe-avatar{width:32px;height:32px;border-radius:50%;background:${s};color:${c};display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:600;flex-shrink:0;overflow:hidden}.koe-avatar img{width:100%;height:100%;object-fit:cover}.koe-author-info{min-width:0}`+`.koe-author-name{color:${n};font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}`+`.koe-author-meta{color:${r};font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px}`+`.koe-date{color:${r};font-size:11px;margin-top:8px}`+`.koe-wall{display:grid;gap:16px;grid-template-columns:repeat(${p},minmax(0,1fr))}`+`@media(max-width:768px){.koe-wall{grid-template-columns:repeat(${Math.min(p,2)},minmax(0,1fr))}}@media(max-width:480px){.koe-wall{grid-template-columns:1fr}}.koe-list{display:flex;flex-direction:column;gap:16px}.koe-carousel{position:relative}.koe-carousel-track{overflow:hidden}.koe-carousel-slide{display:none}.koe-carousel-slide.active{display:block}.koe-carousel-controls{display:flex;align-items:center;justify-content:center;gap:8px;margin-top:12px}`+`.koe-carousel-btn{background:none;border:1px solid ${d};border-radius:50%;width:28px;height:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;`+`color:${n};font-size:14px;line-height:1;transition:background .15s;padding:0}`+`.koe-carousel-btn:hover{background:${i}}.koe-carousel-dots{display:flex;gap:6px;align-items:center}`+`.koe-dot{width:6px;height:6px;border-radius:50%;background:${d};cursor:pointer;border:none;padding:0;transition:background .15s}`+`.koe-dot.active{background:${r}}.koe-badge{display:flex;align-items:center;justify-content:center;padding:8px 0 4px}`+`.koe-badge-link{display:inline-flex;align-items:center;gap:4px;font-size:11px;color:${r};text-decoration:none;opacity:.65;transition:opacity .2s}.koe-badge-link:hover{opacity:1}`}(l),n.appendChild(s);const c=document.createElement("div");let d;c.className="koe-widget",d="carousel"===a.type?function(e,o){return 0===e.length?'<div class="koe-carousel"><div class="koe-carousel-track"></div></div>':`<div class="koe-carousel"><div class="koe-carousel-track">${e.map((e,a)=>`<div class="koe-carousel-slide${0===a?" active":""}" data-index="${a}">`+t(e,o)+"</div>").join("")}</div><div class="koe-carousel-controls"><button class="koe-carousel-btn koe-prev" aria-label="前へ">&#8592;</button><div class="koe-carousel-dots">${e.map((e,t)=>`<button class="koe-dot${0===t?" active":""}" data-index="${t}" aria-label="${t+1}枚目"></button>`).join("")}</div><button class="koe-carousel-btn koe-next" aria-label="次へ">&#8594;</button></div></div>`}(i,l):"list"===a.type?function(e,o){return`<div class="koe-list">${e.map(e=>t(e,o)).join("")}</div>`}(i,l):function(e,o){return`<div class="koe-wall">${e.map(e=>t(e,o)).join("")}</div>`}(i,l),c.innerHTML=d,n.appendChild(c),"carousel"===a.type&&function(e){const t=Array.from(e.querySelectorAll(".koe-carousel-slide")),o=Array.from(e.querySelectorAll(".koe-dot")),a=e.querySelector(".koe-prev"),i=e.querySelector(".koe-next");if(0===t.length)return;let n=0;function r(e){var a,i;t[n].classList.remove("active"),null===(a=o[n])||void 0===a||a.classList.remove("active"),n=(e%t.length+t.length)%t.length,t[n].classList.add("active"),null===(i=o[n])||void 0===i||i.classList.add("active")}null==a||a.addEventListener("click",()=>r(n-1)),null==i||i.addEventListener("click",()=>r(n+1)),o.forEach((e,t)=>e.addEventListener("click",()=>r(t)));const l=setInterval(()=>r(n+1),5e3),s=e.host,c=new MutationObserver(()=>{document.contains(s)||(clearInterval(l),c.disconnect())});c.observe(document,{childList:!0,subtree:!0})}(n),"free"===r&&n.appendChild(function(e){const t=`${e}/?utm_source=widget&utm_medium=badge&utm_campaign=plg`,o=document.createElement("div");return o.className="koe-badge",o.innerHTML=`<a href="${t}" class="koe-badge-link" target="_blank" rel="noopener noreferrer"><svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor" aria-hidden="true"><text x="1" y="10" font-size="10" font-family="sans-serif" font-weight="bold">K</text></svg>Powered by Koe</a>`,o}(o))}).catch(e=>{console.error("[Koe Widget] Failed to initialize:",e)})})}()}();
